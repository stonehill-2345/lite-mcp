# å¤–éƒ¨MCPæœåŠ¡ç®¡ç†å™¨

## æ¦‚è¿°

å¤–éƒ¨MCPæœåŠ¡ç®¡ç†å™¨æ˜¯LiteMCPæ¡†æ¶çš„ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œç”¨äºç»Ÿä¸€ç®¡ç†å’Œé›†æˆç¬¬ä¸‰æ–¹MCPæœåŠ¡ï¼ˆå¦‚`mcp-server-time`ã€`jina-mcp-tools`ç­‰ï¼‰ã€‚é€šè¿‡è¿™ä¸ªç®¡ç†å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»»ä½•æ”¯æŒSTDIOæ¨¡å¼çš„å¤–éƒ¨MCPæœåŠ¡åŒ…è£…æˆHTTPæœåŠ¡ï¼Œå¹¶ç»Ÿä¸€æ³¨å†Œåˆ°LiteMCPçš„ä»£ç†ç³»ç»Ÿä¸­ã€‚

## è®¾è®¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LiteMCP ä»£ç†æœåŠ¡å™¨                            â”‚
â”‚                  (http://host:1888)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ HTTPè¯·æ±‚è½¬å‘
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               å¤–éƒ¨MCPåŒ…è£…å™¨æœåŠ¡å™¨                                â”‚
â”‚            (ExternalMCPServer)                                  â”‚
â”‚              http://host:8714                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ STDIOé€šä¿¡
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å¤–éƒ¨MCPæœåŠ¡è¿›ç¨‹                                     â”‚
â”‚         (å¦‚: mcp-server-time)                                   â”‚
â”‚              STDIOæ¨¡å¼                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç®¡ç†å±‚æ¬¡                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æœåŠ¡ç®¡ç†å™¨      â”‚  â”‚ è¿›ç¨‹ç®¡ç†å™¨      â”‚  â”‚ é…ç½®ç®¡ç†å™¨      â”‚ â”‚
â”‚  â”‚ (é«˜çº§)          â”‚  â”‚ (åº•å±‚)          â”‚  â”‚ (æ•°æ®)          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ æœåŠ¡åè°ƒ
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é€šä¿¡å±‚æ¬¡                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ å¤–éƒ¨MCPæœåŠ¡å™¨   â”‚  â”‚ å¤–éƒ¨MCPå®¢æˆ·ç«¯   â”‚  â”‚ HTTP/SSE/STDIO  â”‚ â”‚
â”‚  â”‚ (HTTPæ¥å£)      â”‚  â”‚ (STDIOé€šä¿¡)     â”‚  â”‚ (ä¼ è¾“åè®®)      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ è¿›ç¨‹é€šä¿¡
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¤–éƒ¨æœåŠ¡å±‚æ¬¡                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ mcp-server-time â”‚  â”‚ jina-mcp-tools  â”‚  â”‚ å…¶ä»–MCPæœåŠ¡     â”‚ â”‚
â”‚  â”‚ (æ—¶é—´å·¥å…·)      â”‚  â”‚ (AIå·¥å…·)        â”‚  â”‚                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

1. **é…ç½®ç®¡ç†å™¨** (`config_manager.py`)
   - ç®¡ç†å¤–éƒ¨MCPæœåŠ¡çš„æ¨¡æ¿é…ç½®å’Œå®ä¾‹é…ç½®
   - æ”¯æŒJSONæ ¼å¼çš„é…ç½®æ–‡ä»¶å­˜å‚¨
   - å¤„ç†å®ä¾‹åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤å’ŒéªŒè¯

2. **åŒ…è£…å™¨æœåŠ¡å™¨** (`external_mcp_server.py`)
   - å°†STDIOæ¨¡å¼çš„å¤–éƒ¨MCPæœåŠ¡åŒ…è£…æˆHTTPæœåŠ¡
   - å¤„ç†MCPåè®®çš„è½¬æ¢å’Œé€šä¿¡
   - æä¾›ExternalMCPClientç”¨äºSTDIOé€šä¿¡
   - æ”¯æŒHTTPã€SSEå’ŒSTDIOä¼ è¾“æ¨¡å¼

3. **è¿›ç¨‹ç®¡ç†å™¨** (`process_manager.py`)
   - å¤–éƒ¨MCPæœåŠ¡çš„åº•å±‚è¿›ç¨‹ç®¡ç†
   - å¤„ç†å­è¿›ç¨‹å¯åŠ¨ã€åœæ­¢å’Œç›‘æ§
   - ç®¡ç†èµ„æºæ¸…ç†å’Œè¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ
   - æä¾›å¥åº·æ£€æŸ¥å’Œè¿›ç¨‹çŠ¶æ€ç›‘æ§

4. **æœåŠ¡ç®¡ç†å™¨** (`service_manager.py`)
   - é«˜çº§æœåŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†
   - åè°ƒé…ç½®ã€è¿›ç¨‹å’Œä»£ç†ç³»ç»Ÿ
   - å¤„ç†æ™ºèƒ½ç«¯å£åˆ†é…å’ŒæœåŠ¡æ³¨å†Œ
   - æä¾›æœåŠ¡æ“ä½œçš„ç»Ÿä¸€API

5. **APIæ¥å£** (`../controller/external_mcp_api.py`)
   - æä¾›RESTful APIç”¨äºç®¡ç†å¤–éƒ¨MCPæœåŠ¡
   - æ”¯æŒCRUDæ“ä½œå’ŒæœåŠ¡æ§åˆ¶
   - å¤„ç†æ¨¡æ¿å’Œå®ä¾‹ç®¡ç†

## å·¥ä½œæµç¨‹

### 1. é…ç½®ç®¡ç†

#### å®ä¾‹é…ç½® (`config/external_mcp_instances.json`)
```json
{
  "263123a5-d745-4c98-9853-042c2c8c838c": {
    "template_name": "time",
    "instance_name": "æˆ‘çš„æ—¶é—´å·¥å…·",
    "enabled": true,
    "transport": "http",
    "host": null,
    "port": null,
    "created": "2025-09-23T09:40:50.114300",
    "updated": "2025-09-23T09:40:50.114557"
  }
}
```

### 2. æœåŠ¡å¯åŠ¨æµç¨‹

1. **è¯»å–é…ç½®**
   - `ExternalMCPConfigManager`åŠ è½½æ¨¡æ¿å’Œå®ä¾‹é…ç½®
   - ç­›é€‰å‡ºå·²å¯ç”¨çš„å®ä¾‹

2. **å¯åŠ¨å¤–éƒ¨è¿›ç¨‹**
   - `ExternalMCPServiceManager`åè°ƒæœåŠ¡å¯åŠ¨
   - `ExternalMCPProcessManager`å¤„ç†åº•å±‚è¿›ç¨‹ç®¡ç†
   - ä½¿ç”¨`subprocess.Popen`å¯åŠ¨åŒ…è£…å™¨è¿›ç¨‹
   - åŒ…è£…å™¨è¿›ç¨‹å†…éƒ¨å¯åŠ¨å¤–éƒ¨MCPæœåŠ¡ï¼ˆSTDIOæ¨¡å¼ï¼‰

3. **å»ºç«‹é€šä¿¡**
   - `ExternalMCPClient`é€šè¿‡STDIOä¸å¤–éƒ¨æœåŠ¡é€šä¿¡
   - ä½¿ç”¨ç‹¬ç«‹çš„è¯»å†™çº¿ç¨‹å¤„ç†JSON-RPCæ¶ˆæ¯
   - `ExternalMCPServer`å¯¹å¤–æä¾›HTTPæ¥å£
   - æ”¯æŒå¤šç§ä¼ è¾“åè®®ï¼ˆHTTPã€SSEã€STDIOï¼‰

4. **æœåŠ¡æ³¨å†Œ**
   - `ExternalMCPServiceManager`å¤„ç†æœåŠ¡æ³¨å†Œ
   - åŒ…è£…å™¨æœåŠ¡å™¨æ³¨å†Œåˆ°LiteMCPä¸»æ³¨å†Œè¡¨
   - é€šè¿‡ä»£ç†æœåŠ¡å™¨ç»Ÿä¸€å¯¹å¤–æä¾›æœåŠ¡
   - æ”¯æŒè‡ªåŠ¨ä»£ç†æ³¨å†Œå’Œæ³¨é”€

### 3. é€šä¿¡åè®®

#### STDIOé€šä¿¡ï¼ˆåŒ…è£…å™¨ â†” å¤–éƒ¨æœåŠ¡ï¼‰
```json
// å‘é€åˆ°å¤–éƒ¨æœåŠ¡
{"jsonrpc": "2.0", "id": "1", "method": "tools/call", "params": {"name": "get_current_time", "arguments": {}}}

// å¤–éƒ¨æœåŠ¡å“åº”
{"jsonrpc": "2.0", "id": "1", "result": {"content": [{"type": "text", "text": "2025-09-23 14:30:00"}]}}
```

#### HTTPé€šä¿¡ï¼ˆå®¢æˆ·ç«¯ â†” åŒ…è£…å™¨ï¼‰
```bash
curl -X POST http://host:8714/mcp \
  -H "Content-Type: application/json" \
  -d '{"method": "tools/call", "params": {"name": "get_current_time", "arguments": {}}, "jsonrpc": "2.0", "id": 1}'
```

## å…³é”®ç‰¹æ€§

### 1. åŠ¨æ€é…ç½®
- **æ¨¡æ¿ç³»ç»Ÿ**ï¼šé¢„å®šä¹‰å¸¸ç”¨å¤–éƒ¨MCPæœåŠ¡çš„é…ç½®æ¨¡æ¿
- **å®ä¾‹ç®¡ç†**ï¼šåŸºäºæ¨¡æ¿åˆ›å»ºå…·ä½“çš„æœåŠ¡å®ä¾‹
- **çƒ­æ›´æ–°**ï¼šæ”¯æŒè¿è¡Œæ—¶æ·»åŠ ã€åˆ é™¤ã€å¯ç”¨/ç¦ç”¨æœåŠ¡
- **é…ç½®éªŒè¯**ï¼šå†…ç½®çš„å®ä¾‹é…ç½®éªŒè¯æœºåˆ¶

### 2. è¿›ç¨‹ç®¡ç†
- **ç‹¬ç«‹è¿›ç¨‹**ï¼šæ¯ä¸ªå¤–éƒ¨æœåŠ¡è¿è¡Œåœ¨ç‹¬ç«‹çš„å­è¿›ç¨‹ä¸­
- **å¥åº·æ£€æŸ¥**ï¼šå®æ—¶ç›‘æ§è¿›ç¨‹å’Œé€šä¿¡çº¿ç¨‹çŠ¶æ€
- **è‡ªåŠ¨é‡å¯**ï¼šæœåŠ¡å´©æºƒæ—¶è‡ªåŠ¨é‡å¯
- **ä¼˜é›…å…³é—­**ï¼šæ”¯æŒæ­£ç¡®çš„è¿›ç¨‹æ¸…ç†
- **èµ„æºç®¡ç†**ï¼šè‡ªåŠ¨æ¸…ç†è¿›ç¨‹å’Œèµ„æº

### 3. æœåŠ¡ç®¡ç†
- **ç»Ÿä¸€æœåŠ¡ç®¡ç†å™¨**ï¼šé«˜çº§åè°ƒæ‰€æœ‰æœåŠ¡æ“ä½œ
- **æ™ºèƒ½ç«¯å£åˆ†é…**ï¼šè‡ªåŠ¨ç«¯å£åˆ†é…å’Œå†²çªè§£å†³
- **ä»£ç†é›†æˆ**ï¼šä¸LiteMCPä»£ç†ç³»ç»Ÿæ— ç¼é›†æˆ
- **æœåŠ¡å‘ç°**ï¼šè‡ªåŠ¨æœåŠ¡æ³¨å†Œå’Œå‘ç°

### 4. é”™è¯¯å¤„ç†
- **è¿æ¥é‡è¯•**ï¼šé€šä¿¡å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
- **é”™è¯¯æ—¥å¿—**ï¼šè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œè°ƒè¯•æ—¥å¿—
- **é™çº§å¤„ç†**ï¼šæœåŠ¡ä¸å¯ç”¨æ—¶è¿”å›å‹å¥½çš„é”™è¯¯ä¿¡æ¯
- **å¥åº·ç›‘æ§**ï¼šæŒç»­çš„å¥åº·æ£€æŸ¥å’ŒçŠ¶æ€æŠ¥å‘Š

### 5. é›†æˆç‰¹æ€§
- **ç»Ÿä¸€ä»£ç†**ï¼šé€šè¿‡LiteMCPä»£ç†æœåŠ¡å™¨ç»Ÿä¸€è®¿é—®
- **é…ç½®API**ï¼šè‡ªåŠ¨å‡ºç°åœ¨`/config`æ¥å£ä¸­
- **å‹å¥½å‘½å**ï¼šæ”¯æŒä¸­æ–‡æ˜¾ç¤ºåç§°å’Œè‹±æ–‡URLè·¯å¾„
- **å¤šä¼ è¾“æ”¯æŒ**ï¼šHTTPã€SSEå’ŒSTDIOä¼ è¾“æ¨¡å¼

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

é¦–å…ˆç¡®ä¿ç³»ç»Ÿå·²å®‰è£…å¿…è¦çš„å·¥å…·ï¼š

```bash
# å®‰è£…uvxï¼ˆç”¨äºPython MCPæœåŠ¡ï¼‰
pip install uv

# å®‰è£…Node.jså’Œnpmï¼ˆç”¨äºnpx MCPæœåŠ¡ï¼‰
# æ ¹æ®ä½ çš„æ“ä½œç³»ç»Ÿå®‰è£…Node.js

# éªŒè¯å®‰è£…
uvx --version
npx --version
```

### 2. å®‰è£…å¤–éƒ¨MCPæœåŠ¡

```bash
# å®‰è£…æ—¶é—´æœåŠ¡å™¨
uvx install mcp-server-time

# å®‰è£…æ–‡ä»¶ç³»ç»ŸæœåŠ¡å™¨
uvx install mcp-server-filesystem

# æµ‹è¯•å®‰è£…ï¼ˆå¯é€‰ï¼‰
uvx mcp-server-time --help
```

### 3. é…ç½®å¤–éƒ¨æœåŠ¡

ç¼–è¾‘ `config/external_mcp_servers.yaml`ï¼š

```yaml
external_mcp_servers:
  time:
    enabled: true                    # å¯ç”¨æ—¶é—´æœåŠ¡å™¨
    name: "time"
    command: "uvx"
    args: ["mcp-server-time", "--local-timezone=Asia/Shanghai"]
    env: {}
    description: "æ—¶é—´å’Œæ—¥æœŸæ“ä½œå·¥å…·æœåŠ¡å™¨"
```

### 4. é…ç½®LiteMCPå¯åŠ¨

ç¼–è¾‘ `config/servers.yaml`ï¼š

```yaml
mcp_servers:
  external_time:
    enabled: true                    # å¯ç”¨å¤–éƒ¨æ—¶é—´æœåŠ¡å™¨
    server_type: "external_time"     
    transport: "http"                
    host: null                       
    port: null                       
    auto_restart: true               
    description: "æ—¶é—´å’Œæ—¥æœŸæ“ä½œå·¥å…·æœåŠ¡å™¨ï¼ˆå¤–éƒ¨uvxæœåŠ¡ï¼‰"
```

### 5. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
./scripts/manage.sh up

# æˆ–è€…åªå¯åŠ¨å¤–éƒ¨æ—¶é—´æœåŠ¡å™¨
./scripts/manage.sh up --name external_time

# æ£€æŸ¥çŠ¶æ€
./scripts/manage.sh ps
```

## ğŸ“‹ å†…ç½®å¤–éƒ¨æœåŠ¡ç¤ºä¾‹

### æ—¶é—´æœåŠ¡å™¨ (external_time)

åŸºäº `mcp-server-time` çš„æ—¶é—´æ“ä½œå·¥å…·ã€‚

**åŠŸèƒ½ç‰¹æ€§**:
- è·å–å½“å‰æ—¶é—´å’Œæ—¥æœŸ
- æ—¶åŒºè½¬æ¢
- æ—¥æœŸæ ¼å¼åŒ–
- æ—¶é—´è®¡ç®—

**é…ç½®ç¤ºä¾‹**:
```yaml
time:
  enabled: true
  name: "time"
  command: "uvx"
  args: ["mcp-server-time", "--local-timezone=Asia/Shanghai"]
  env: {}
  description: "æ—¶é—´å’Œæ—¥æœŸæ“ä½œå·¥å…·æœåŠ¡å™¨"
```

**ä½¿ç”¨ç¤ºä¾‹**:
```
- "è·å–å½“å‰åŒ—äº¬æ—¶é—´"
- "å°†æ—¶é—´è½¬æ¢ä¸ºUTC"
- "è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„å·®å¼‚"
```

### Jina AIå·¥å…·é›† (external_jina)

åŸºäº `jina-mcp-tools` çš„AIé©±åŠ¨å·¥å…·é›†ã€‚

**åŠŸèƒ½ç‰¹æ€§**:
- ç½‘é¡µå†…å®¹æœç´¢å’Œåˆ†æ
- æ–‡æœ¬æ‘˜è¦å’Œæå–
- è¯­ä¹‰æœç´¢
- æ–‡æ¡£ç†è§£

**é…ç½®ç¤ºä¾‹**:
```yaml
jina-tools:
  enabled: true
  name: "jina-tools"
  command: "npx"
  args: ["jina-mcp-tools"]
  env:
    JINA_API_KEY: "${JINA_API_KEY}"  # ä»ç¯å¢ƒå˜é‡è·å–
  description: "Jina AIå·¥å…·é›†"
```

**ç¯å¢ƒå˜é‡è®¾ç½®**:
```bash
export JINA_API_KEY="your_actual_api_key"
```

**ä½¿ç”¨ç¤ºä¾‹**:
```
- "æœç´¢å…³äºæœºå™¨å­¦ä¹ çš„æœ€æ–°æ–‡ç« "
- "æ€»ç»“è¿™ä¸ªç½‘é¡µçš„å†…å®¹"
- "åˆ†æè¿™æ®µæ–‡æœ¬çš„å…³é”®ä¿¡æ¯"
```

### æ–‡ä»¶ç³»ç»Ÿå·¥å…· (external_filesystem)

åŸºäº `mcp-server-filesystem` çš„æ–‡ä»¶æ“ä½œå·¥å…·ã€‚

**åŠŸèƒ½ç‰¹æ€§**:
- æ–‡ä»¶è¯»å–å’Œå†™å…¥
- ç›®å½•åˆ›å»ºå’Œåˆ é™¤
- æ–‡ä»¶æœç´¢å’Œåˆ—è¡¨
- æ–‡ä»¶ä¿¡æ¯æŸ¥è¯¢

**é…ç½®ç¤ºä¾‹**:
```yaml
filesystem:
  enabled: true
  name: "filesystem"
  command: "uvx"
  args: ["mcp-server-filesystem", "--write-to-cwd"]
  env: {}
  description: "æ–‡ä»¶ç³»ç»Ÿæ“ä½œå·¥å…·"
```

**å®‰å…¨æ³¨æ„**:
- é»˜è®¤åªå…è®¸åœ¨å½“å‰å·¥ä½œç›®å½•ä¸‹æ“ä½œ
- å»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨
- æ³¨æ„æ–‡ä»¶æƒé™å’Œè·¯å¾„å®‰å…¨

**ä½¿ç”¨ç¤ºä¾‹**:
```
- "è¯»å–config.txtæ–‡ä»¶çš„å†…å®¹"
- "åœ¨tempç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶"
- "åˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰.pyæ–‡ä»¶"
```

## ğŸ”§ è‡ªå®šä¹‰å¤–éƒ¨æœåŠ¡

### 1. æ·»åŠ é…ç½®

åœ¨ `config/external_mcp_servers.yaml` ä¸­æ·»åŠ æ–°æœåŠ¡ï¼š

```yaml
external_mcp_servers:
  my-custom-service:
    enabled: true
    name: "my-custom"
    command: "python"  # æˆ– uvx, npx ç­‰
    args: ["/path/to/your/mcp_server.py"]
    env:
      CUSTOM_CONFIG: "value"
      API_KEY: "${MY_API_KEY}"
    description: "æˆ‘çš„è‡ªå®šä¹‰MCPæœåŠ¡"
    timeout: 45
    auto_restart: true
```

### 2. åˆ›å»ºåŒ…è£…å™¨ç±»

åˆ›å»º `src/tools/external/my_custom_server.py`ï¼š

```python
from .external_mcp_server import ExternalMCPServer, ExternalMCPConfig
from src.core.statistics import mcp_author

@mcp_author("ä½ çš„åå­—", department="æµ‹è¯•éƒ¨", project=["TD"])
class MyCustomMCPServer(ExternalMCPServer):
    """è‡ªå®šä¹‰å¤–éƒ¨MCPæœåŠ¡åŒ…è£…å™¨"""
    
    def __init__(self, name: str = "LiteMCP-MyCustom"):
        config = ExternalMCPConfig(
            name="my-custom",
            command="python",
            args=["/path/to/your/mcp_server.py"],
            env={"CUSTOM_CONFIG": "value"},
            description="æˆ‘çš„è‡ªå®šä¹‰MCPæœåŠ¡",
            timeout=45,
            auto_restart=True
        )
        super().__init__(config, name)
```

### 3. æ³¨å†ŒæœåŠ¡

åœ¨ `src/tools/__init__.py` ä¸­æ·»åŠ ï¼š

```python
AVAILABLE_SERVERS = {
    # ... å…¶ä»–æœåŠ¡
    "my_custom": {
        "description": "æˆ‘çš„è‡ªå®šä¹‰MCPæœåŠ¡",
        "module": "src.tools.external.my_custom_server",
        "class": "MyCustomMCPServer"
    }
}
```

### 4. é…ç½®å¯åŠ¨

åœ¨ `config/servers.yaml` ä¸­æ·»åŠ ï¼š

```yaml
mcp_servers:
  my_custom:
    enabled: true
    server_type: "my_custom"
    transport: "http"
    host: null
    port: null
    auto_restart: true
    description: "æˆ‘çš„è‡ªå®šä¹‰MCPæœåŠ¡"
```

## ğŸ› ï¸ é…ç½®ç®¡ç†

### ç¯å¢ƒå˜é‡æ”¯æŒ

é…ç½®æ–‡ä»¶æ”¯æŒç¯å¢ƒå˜é‡æ›¿æ¢ï¼š

```yaml
external_mcp_servers:
  my-service:
    env:
      API_KEY: "${MY_API_KEY}"          # ä»ç¯å¢ƒå˜é‡è·å–
      BASE_URL: "${BASE_URL:-http://localhost}"  # å¸¦é»˜è®¤å€¼
```

### å…¨å±€é…ç½®

```yaml
global_config:
  default_timeout: 30                 # é»˜è®¤è¶…æ—¶æ—¶é—´
  enable_monitoring: true             # å¯ç”¨ç›‘æ§
  restart_policy:
    max_retries: 3                    # æœ€å¤§é‡è¯•æ¬¡æ•°
    retry_interval: 10                # é‡è¯•é—´éš”
  logging:
    level: "INFO"                     # æ—¥å¿—çº§åˆ«
    include_external_output: true     # åŒ…å«å¤–éƒ¨æœåŠ¡è¾“å‡º
```

### é…ç½®éªŒè¯

ä½¿ç”¨é…ç½®ç®¡ç†å™¨éªŒè¯é…ç½®ï¼š

```python
from src.tools.external.config_manager import external_config_manager

# éªŒè¯é…ç½®
validation_result = external_config_manager.validate_config()
print("é”™è¯¯:", validation_result["errors"])
print("è­¦å‘Š:", validation_result["warnings"])

# è·å–å¯ç”¨çš„æœåŠ¡
enabled_servers = external_config_manager.get_enabled_servers()
print("å¯ç”¨çš„æœåŠ¡:", list(enabled_servers.keys()))
```

## ä½¿ç”¨æ–¹æ³•

### 1. é€šè¿‡manage.pyç®¡ç†

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåŒ…æ‹¬å¤–éƒ¨MCPæœåŠ¡ï¼‰
./scripts/manage.sh up

# åœæ­¢æ‰€æœ‰æœåŠ¡
./scripts/manage.sh down

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./scripts/manage.sh ps
```

### 2. é€šè¿‡APIç®¡ç†

```bash
# è·å–æ‰€æœ‰æ¨¡æ¿
curl http://localhost:9000/external-mcp/templates

# åˆ›å»ºå®ä¾‹
curl -X POST http://localhost:9000/external-mcp/instances \
  -H "Content-Type: application/json" \
  -d '{"template_name": "time", "instance_name": "æˆ‘çš„æ—¶é—´å·¥å…·"}'

# å¯ç”¨å®ä¾‹
curl -X POST http://localhost:9000/external-mcp/instances/{instance_id}/enable

# å¯åŠ¨æœåŠ¡
curl -X POST http://localhost:9000/external-mcp/instances/{instance_id}/start
```

### 3. ç›´æ¥è®¿é—®æœåŠ¡

```bash
# é€šè¿‡ä»£ç†è®¿é—®ï¼ˆæ¨èï¼‰
curl http://127.0.0.1:1888/mcp/external-time

# ç›´æ¥è®¿é—®åŒ…è£…å™¨
curl http://172.17.18.20:8714/mcp
```

## ğŸ“Š ç›‘æ§å’Œè°ƒè¯•

### æŸ¥çœ‹å¤–éƒ¨æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
./scripts/manage.sh ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
tail -f runtime/logs/litemcp_src_tools_external_time_server_TimeMCPServer.log

# è¯¦ç»†å¯åŠ¨ä¿¡æ¯
./scripts/manage.sh up --name external_time --verbose
```

### è°ƒè¯•å¤–éƒ¨æœåŠ¡

1. **æ£€æŸ¥å‘½ä»¤æ˜¯å¦å¯ç”¨**:
   ```bash
   uvx --version
   uvx mcp-server-time --help
   ```

2. **æµ‹è¯•å¤–éƒ¨æœåŠ¡ç‹¬ç«‹è¿è¡Œ**:
   ```bash
   uvx mcp-server-time --local-timezone=Asia/Shanghai
   ```

3. **æ£€æŸ¥ç¯å¢ƒå˜é‡**:
   ```bash
   echo $JINA_API_KEY
   ```

4. **æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—**:
   ```bash
   ./scripts/manage.sh up --name external_jina --verbose
   ```

## æ–‡ä»¶ç»“æ„

```
src/tools/external/
â”œâ”€â”€ README.md                    # æœ¬æ–‡æ¡£ï¼ˆä¸­æ–‡ï¼‰
â”œâ”€â”€ README.zh_CN.md              # è‹±æ–‡ç‰ˆæœ¬
â”œâ”€â”€ __init__.py                  # æ¨¡å—åˆå§‹åŒ–
â”œâ”€â”€ config_manager.py            # é…ç½®ç®¡ç†å™¨
â”œâ”€â”€ external_mcp_server.py       # åŒ…è£…å™¨æœåŠ¡å™¨
â”œâ”€â”€ process_manager.py           # è¿›ç¨‹ç®¡ç†å™¨
â””â”€â”€ service_manager.py           # æœåŠ¡ç®¡ç†å™¨

config/
â””â”€â”€ external_mcp.json            # å®ä¾‹é…ç½®

src/controller/
â””â”€â”€ external_mcp_api.py          # APIæ§åˆ¶å™¨
```

## æ•…éšœæ’é™¤

### 1. æœåŠ¡å¯åŠ¨å¤±è´¥
- æ£€æŸ¥å¤–éƒ¨å‘½ä»¤æ˜¯å¦å¯ç”¨ï¼ˆå¦‚`uvx`ã€`npx`ï¼‰
- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š`runtime/logs/litemcp_src_tools_external_*.log`
- ç¡®è®¤ç«¯å£æœªè¢«å ç”¨

### 2. é€šä¿¡é—®é¢˜
- æ£€æŸ¥STDIOé€šä¿¡çº¿ç¨‹æ˜¯å¦æ­£å¸¸
- éªŒè¯JSON-RPCæ¶ˆæ¯æ ¼å¼
- æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€ï¼š`ps aux | grep mcp-server`

### 3. ä»£ç†æ³¨å†Œé—®é¢˜
- ç¡®è®¤ä»£ç†æœåŠ¡å™¨è¿è¡Œæ­£å¸¸
- æ£€æŸ¥æœåŠ¡æ³¨å†ŒçŠ¶æ€ï¼š`curl http://host:1888/proxy/status`
- éªŒè¯é…ç½®APIè¿”å›ï¼š`curl http://localhost:9000/config`

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„å¤–éƒ¨MCPæœåŠ¡

1. **æ·»åŠ æ¨¡æ¿é…ç½®**
   ```json
   {
     "new_service": {
       "name": "new-service",
       "display_name": "æ–°æœåŠ¡",
       "command": "npx",
       "args": ["new-mcp-service"],
       "env": {"API_KEY": "your_key"},
       "description": "æ–°çš„MCPæœåŠ¡",
       "category": "utility",
       "transport": "http",
       "host": null,
       "port": null
     }
   }
   ```

2. **åˆ›å»ºå®ä¾‹**
   - é€šè¿‡APIæˆ–ç›´æ¥ä¿®æ”¹`external_mcp_instances.json`

3. **å¯åŠ¨æœåŠ¡**
   - ä½¿ç”¨`manage.py up`æˆ–APIæ¥å£

### è‡ªå®šä¹‰åŒ…è£…å™¨

å¦‚æœéœ€è¦ç‰¹æ®Šçš„å¤„ç†é€»è¾‘ï¼Œå¯ä»¥ç»§æ‰¿`ExternalMCPServer`ï¼š

```python
class CustomExternalMCPServer(ExternalMCPServer):
    def _register_tools(self):
        super()._register_tools()
        # æ·»åŠ è‡ªå®šä¹‰é€»è¾‘
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### å®‰å…¨è€ƒè™‘
- å¤–éƒ¨æœåŠ¡è¿è¡Œåœ¨ç‹¬ç«‹è¿›ç¨‹ä¸­ï¼Œå…·æœ‰ç›¸åŒçš„ç³»ç»Ÿæƒé™
- æ–‡ä»¶ç³»ç»ŸæœåŠ¡éœ€è¦ç‰¹åˆ«æ³¨æ„è·¯å¾„å®‰å…¨
- API Keyç­‰æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†

### æ€§èƒ½å½±å“
- å¤–éƒ¨æœåŠ¡å¯åŠ¨éœ€è¦é¢å¤–æ—¶é—´
- è¿›ç¨‹é—´é€šä¿¡ä¼šå¢åŠ å»¶è¿Ÿ
- å»ºè®®æ ¹æ®å®é™…éœ€æ±‚å¯ç”¨æœåŠ¡

### å…¼å®¹æ€§
- ç¡®ä¿å¤–éƒ¨MCPæœåŠ¡æ”¯æŒJSON-RPC 2.0åè®®
- ä¸åŒç‰ˆæœ¬çš„å¤–éƒ¨æœåŠ¡å¯èƒ½æœ‰APIå·®å¼‚
- å»ºè®®å®šæœŸæ›´æ–°å¤–éƒ¨æœåŠ¡ç‰ˆæœ¬

### æ•…éšœæ’é™¤
1. **æœåŠ¡å¯åŠ¨å¤±è´¥**: æ£€æŸ¥å‘½ä»¤æ˜¯å¦å¯ç”¨ã€æƒé™æ˜¯å¦è¶³å¤Ÿ
2. **å·¥å…·è°ƒç”¨å¤±è´¥**: æ£€æŸ¥å‚æ•°æ ¼å¼ã€API Keyé…ç½®
3. **è¿æ¥è¶…æ—¶**: è°ƒæ•´timeoutè®¾ç½®
4. **è¿›ç¨‹å¼‚å¸¸é€€å‡º**: æ£€æŸ¥å¤–éƒ¨æœåŠ¡çš„é”™è¯¯æ—¥å¿—

### å¼€å‘æ³¨æ„äº‹é¡¹
1. **è¿›ç¨‹ç®¡ç†**ï¼šå¤–éƒ¨MCPæœåŠ¡è¿è¡Œåœ¨ç‹¬ç«‹è¿›ç¨‹ä¸­ï¼Œç¡®ä¿æ­£ç¡®çš„æ¸…ç†
2. **ç«¯å£åˆ†é…**ï¼šä½¿ç”¨LiteMCPçš„ç«¯å£ç®¡ç†ç³»ç»Ÿé¿å…å†²çª
3. **é”™è¯¯å¤„ç†**ï¼šå¤–éƒ¨æœåŠ¡å¯èƒ½ä¸ç¨³å®šï¼Œéœ€è¦å¥å£®çš„é”™è¯¯å¤„ç†
4. **èµ„æºæ¸…ç†**ï¼šåœæ­¢æœåŠ¡æ—¶ç¡®ä¿æ‰€æœ‰ç›¸å…³è¿›ç¨‹éƒ½è¢«æ­£ç¡®ç»ˆæ­¢
5. **æ—¥å¿—è®°å½•**ï¼šä¿æŒè¯¦ç»†çš„æ—¥å¿—ç”¨äºé—®é¢˜è¯Šæ–­

## ğŸ“š æ‰©å±•é˜…è¯»

- [MCPåè®®å®˜æ–¹æ–‡æ¡£](https://modelcontextprotocol.io/)
- [å¯ç”¨çš„MCPæœåŠ¡å™¨åˆ—è¡¨](https://github.com/modelcontextprotocol/servers)
- [LiteMCPæ¡†æ¶ä½¿ç”¨æ–‡æ¡£](../../../docs/USAGE.md)
- [å¤–éƒ¨MCPæœåŠ¡é›†æˆæŒ‡å—](../../../docs/EXTERNAL_MCP_GUIDE.md)

é€šè¿‡å¤–éƒ¨MCPæœåŠ¡é›†æˆåŠŸèƒ½ï¼ŒLiteMCPæ¡†æ¶å¯ä»¥è½»æ¾å¤ç”¨ç¤¾åŒºå·²æœ‰çš„MCPå·¥å…·ï¼Œå¤§å¤§æ‰©å±•äº†æ¡†æ¶çš„èƒ½åŠ›èŒƒå›´ã€‚

*æœ¬æ–‡æ¡£æè¿°äº†LiteMCPå¤–éƒ¨MCPæœåŠ¡ç®¡ç†å™¨çš„è®¾è®¡å’Œä½¿ç”¨æ–¹æ³•ã€‚å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–é€šè¿‡forkè´¡çŒ®ä»£ç ã€‚*
